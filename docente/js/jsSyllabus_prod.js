var getSyllabus,showTabla,showNotas,objAsignaturas,objMaximo,cargaGrilla,contador=0,cont2=0,auxRamo,existe=0;$(document).ready(function(){function a(a){return null!=a&&""!=a?a.replace(/\n/g,"\\n"):a}$("#tabs").tabs(),$.fn.serializeObject=function(){var a={},t=this.serializeArray();return $.each(t,function(){a[this.name]?(a[this.name].push||(a[this.name]=[a[this.name]]),a[this.name].push(this.value||"")):a[this.name]=this.value||""}),a},cargaGrilla=function(){$("#tabs").hide(),$("#uniTem").html(""),$.ajax({type:"POST",url:"ajax/getAsignaturas.asp",data:{rut:9334854},success:function(a){ultimo=a.cursos.length,a.cursos.splice(ultimo-1,1),showTable(a),$("#formulario").show()}})},cargaGrilla(),showTable=function(a){objAsignaturas=a.cursos,$("#asignaturas").html("<thead><tr><td>Codigo</td><td>Asignatura</td><td>Paralelo</td><td>Tipo</td><td>Docente</td><td>Syllabus</td></tr></thead><tbody></tbody>"),$("#asignaturas").dataTable({pagingType:"full_numbers",aaData:a.cursos,aoColumns:[{mData:"idAsignatura"},{mData:"Asignatura"},{mData:"Paralelo"},{mData:"Tipo"},{mData:"nombre",sClass:"capital"},{mData:null,mRender:function(a,t,e){return'<input type="button" onclick="getSyllabus('+e.idAsignatura+')" value="Ver"/>'}}],bDestroy:!0}).fnDraw()},getSyllabus=function(a){var t=_.where(objAsignaturas,{idAsignatura:a.toString()});t=t[0],auxRamo=t,$("#asignaturas_wrapper").effect("drop"),$("#tabs").effect("slide"),$("#tabs").tabs("select",0),$("#asignatura").val(t.Asignatura),$("#carrera").val(t.Carrera),$("#profesor").val(t.nombre),$("#correo").val(t.email),$("#cdAsigna").val(a),$("#requisitos").html(""),$.ajax({type:"POST",url:"ajax/getRequisitos.asp",data:{codigo:a},success:function(a){ultimo=a.prerequisitos.length,a.prerequisitos.splice(ultimo-1,1),a.prerequisitos.length<1?$("#requisitos").append("No tiene"):$.each(a.prerequisitos,function(a,t){$("#requisitos").append(t.Prerequisito+"\n")})}}),$.ajax({type:"POST",url:"ajax/getUdust.asp",data:{codigo:a,tipo:t.Tipo},success:function(a){ultimo=a.creditos.length,a.creditos.splice(ultimo-1,1),$("#ud").val(a.creditos[0].ud),$("#ust").val(a.creditos[0].ust),$("#autonomo").val(a.creditos[0].trabajo),$("#perfil").val(a.creditos[0].perfil)}});var e={};e.cdAsigna=a,e.cdCarrera=auxRamo.idCarrera,e.Semestre=1,e.Anio=2014,$.ajax({type:"POST",url:"ajax/getSylla_uno.asp",data:e,success:function(a){$("#horarios").val(a.horario),$("#atencion").val(a.atencion),$("#estrategia").val(a.estrategia),$("#reglas").val(a.reglas)}}),$.ajax({type:"POST",url:"ajax/getPruebas.asp",data:{codigo:a,tipo:t.Tipo,paralelo:t.Paralelo,carrera:t.idCarrera},success:function(a){ultimo=a.pruebas.length,a.pruebas.splice(ultimo-1,1);var t=0,e=0;$.each(a.pruebas,function(a,r){t+=parseInt(r.porcentaje),e=r.numero}),e=parseInt(e)+1,e=e.toString();var r={};r.numero=e,r.nombre="Total",r.porcentaje=t.toString(),r.glosa="",a.pruebas.push(r),showTabla(a)}})},showTabla=function(a){$("#tablaNotas").html("<thead><tr><td>Orden</td><td>Evaluaciones</td><td>Ponderaciones</td></tr></thead><tbody></tbody>"),$("#tablaNotas").dataTable({pagingType:"full_numbers",aaData:a.pruebas,aoColumns:[{mData:"numero"},{mData:"nombre"},{mData:null,mRender:function(a,t,e){return e.porcentaje+"%"}}],bDestroy:!0}).fnDraw()},$("#paso1").click(function(){var t=$("#autonomo").val(),e=a($("#perfil").val()),r=auxRamo.idAsignatura;$.ajax({type:"POST",url:"ajax/setHorasPerfil.asp",data:{idAsig:r,hrsAuto:t,perEgreso:e},success:function(){}});var s=$("#cabSyllabus").serializeObject();s.horarios=a($("#horarios").val()),s.cdCarrera=auxRamo.idCarrera,s.Semestre=1,s.Anio=2014,s.userRut="9334854",$.ajax({type:"POST",url:"ajax/setSyllabus.asp",data:s,success:function(){}}),$("#tabs").tabs("select",1),$("#paso2").removeAttr("disabled")}),$("#paso2").click(function(){var t={};t.cdAsigna=auxRamo.idAsignatura,t.cdCarrera=auxRamo.idCarrera,t.Semestre=1,t.Anio=2014,t.estrategia=a($("#estrategia").val()),t.userRut="9334854",$.ajax({type:"POST",url:"ajax/upEstrategia.asp",data:t,success:function(){}}),$("#tabs").tabs("select",2),$("#paso3").removeAttr("disabled")}),$("#paso3").click(function(){var t={};t.cdAsigna=auxRamo.idAsignatura,t.cdCarrera=auxRamo.idCarrera,t.Semestre=1,t.Anio=2014,t.reglas=a($("#reglas").val()),t.userRut="9334854",$.ajax({type:"POST",url:"ajax/upReglas.asp",data:t,success:function(){}}),$("#tabs").tabs("select",3)}),$("#paso4").click(function(){cargaGrilla(),$("#paso2").attr("disabled","disabled"),$("#paso3").attr("disabled","disabled")}),$("body").on("click",".guardaUnidad",function(){alert("Guardando"),aux=contador-1,$.ajax({type:"POST",url:"ajax/getMaxUnidad.asp",async:!1,data:{asignatura:auxRamo.idAsignatura},success:function(a){objMaximo=a}});var a=(parseInt(objMaximo.nivel)+1,parseInt(objMaximo.subnivel)+1,$("#formUt"+aux).serializeObject());a.cdasigna=auxRamo.idAsignatura,$.ajax({type:"POST",url:"ajax/setUnidad.asp",data:a,success:function(){}}),$("#uniTem").html(""),$("#agregaUt").removeAttr("disabled"),cont2=0}),$("body").on("click",".resAp",function(){var a=$(this).attr("id"),t="divRes"+a,e="Resultado de Aprendizaje: <input type'text' name='subResultado"+a+cont2+"' id='subResultado"+a+cont2+"' /></br>";$("#"+t).append(e),cont2++}),$("#agregaUt").click(function(){var a="</br><form id='formUt"+contador+"'>Nombre Unidad Tematica: ";a+="<input type='text' id='contenido"+contador+"' name='contenido"+contador+"' />",a+="<input type='button' class='resAp' id='"+contador+"' value='Agregar Resultado' />",a+="</br><div id='divRes"+contador+"'></div></br>",a+="<input type='button' class='guardaUnidad' value='Guardar Unidad' /> </form>",$("#uniTem").append(a),contador++,$(this).attr("disabled","disabled")})});